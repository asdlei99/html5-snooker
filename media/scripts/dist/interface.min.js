$(function() {
	var ua = navigator.userAgent.toString().toLowerCase();
	if (supports_local_storage() && supports_canvas() && !($.browser.opera && parseInt($.browser.version) < 10) && !((ua.indexOf("safari") != -1) && !(ua.indexOf("chrome") != -1))) {
		$("#browser-detect").parent().hide()
	} else {
		return
	}
});

if (supports_local_storage()) {
	config.skin = __0("skin");
	config.player = __0("player");
	config.screoboard_pos = __0("scoreboard_pos");
	config.screoboard_style = __0("scoreboard_style");
	config.shadows = __0("shadows");
	config.background = __0("background");
	config.hints = __0("hints");
	config.cue = __0("cue")
}

//unload时调用后台断开连接
$(window).bind("unload", function(e) {
	$.ajax({
		url: config.masterserver + "?query=send&id=" + network.vars.id + "&event=disconnect",
		success: function(data) {},
		async: false
	})
});

window_active = true;
$(window).focus(function() {
	window_active = true
});
$(window).blur(function() {
	window_active = false
});

var auto_refresh_timeout = null;
$(function() {
	$("body").css("overflow", "hidden");
	if ($(window).height() <= 666) {
		$("body").css("overflow-y", "scroll")
	}
	$(window).resize(function() {
		if ($(window).height() <= 666) {
			$("body").css("overflow-y", "scroll")
		} else {
			$("body").css("overflow-y", "hidden")
		}
	});
	network.prepare();
	if (__0("player") == "Guest") {
		$("#enter-name").parent(".wrapper").removeClass("closed")
	}
	$(window).keyup(function(e) {
		if ($("#enter-name").is(":visible")) {
			if ($("#enter-name input[name=player]").val() != "") {
				$("#enter-name button[name=save]").removeAttr("disabled")
			} else {
				$("#enter-name button[name=save]").attr("disabled", "disabled")
			}
		}
	});
	$("#enter-name input[name=player]").change(function() {
		if ($(this).val() != "") {
			$(this).parents("#enter-name").find("button[name=save]").removeAttr("disabled")
		} else {
			$(this).parents("#enter-name").find("button[name=save]").attr("disabled", "disabled")
		}
	});
	$("#enter-name button[name=save]").click(function() {
		var _10e = $("#enter-name input[name=player]").val();
		if (_10e != "") {
			__2("player", _10e);
			__2("enter-name", "off");
			$.ajax({
				url: "dashboard.php",
				cache: false,
				data: {
					"nick": _10e
				}
			});
			$("#enter-name").parent().addClass("closed")
		}
		return false
	});
	$("#community-menu ul.categories li a[href=#news]").click(function() {
		$("#news").parent().removeClass("closed");
		return false
	});
	$("#community-menu ul.categories li a[href=#welcome-screen]").click(function() {
		$("#welcome-screen").parent().show();
		return false
	});
	$("#community-menu ul.categories li a[href=#webchat], #irc-webchat .top-panel").click(function() {
		$("#irc-webchat").toggleClass("closed");
		return false
	});
	$("#community-menu ul.categories li a[href=#credits]").click(function() {
		$("#credits").parent(".wrapper").toggleClass("closed");
		return false
	});
	$("a.irc").live("click",
	function() {
		$("#irc-webchat").removeClass("closed");
		return false
	});
	$("#news .top-panel").click(function() {
		$(this).parents(".wrapper").toggleClass("closed");
		__2("news-" + hex_md5($("#news ul li:first time").text()), "off");
		return false
	});
	$("#news button[name=okay]").click(function() {
		$(this).parents(".wrapper").addClass("closed");
		__2("news-" + hex_md5($("#news ul li:first time").text()), "off");
		return false
	});
	$("#credits button[name=okay]").click(function() {
		$(this).parents(".wrapper").addClass("closed");
		return false
	});
	$("div.social iframe").load(function() {
		$(this).parent(".social").width($(this).width() - 5)
	});
	$("button[name=welcome]").click(function() {
		notify_permission();
		$(this).parents(".wrapper").hide();
		_10f();
		$("#settings").parents(".wrapper").removeClass("closed");
		return false
	});
	function _10f() {
		$("#settings input[name=player]").val(__0("player"));
		$("#settings select[name=skin]").val(__0("skin"));
		$("#settings select[name=scoreboard-style]").val(__0("scoreboard_style"));
		$("#settings radio").removeAttr("checked");
		$("#settings input:radio[value=" + __0("scoreboard_pos") + "]").attr("checked", "checked");
		$("#settings input[name=sound]").attr("checked", __0("sound") == "on");
		$("#settings input[name=shadows]").attr("checked", __0("shadows") == "on");
		$("#settings input[name=hints]").attr("checked", __0("hints") == "on");
		$("#settings input[name=cue]").attr("checked", __0("cue") == "on");
		$("#settings select[name=background]").val(__0("background"))
	};
	function _110(init) {
		if (typeof init == "undefined") {
			init = false
		}
		__2("player", $("#settings input[name=player]").val());
		__2("skin", $("#settings select[name=skin]").val());
		__2("scoreboard_pos", $("#settings input:radio[name=scoreboard-position]:checked").val());
		__2("scoreboard_style", $("#settings select[name=scoreboard-style]").val());
		__2("sound", ($("#settings input[name=sound]").attr("checked") ? "on": "off"));
		__2("shadows", ($("#settings input[name=shadows]").attr("checked") ? "on": "off"));
		__2("hints", ($("#settings input[name=hints]").attr("checked") ? "on": "off"));
		__2("background", $("#settings select[name=background]").val());
		__2("cue", ($("#settings input[name=cue]").attr("checked") ? "on": "off"));
		if (!init) {
			$.ajax({
				url: "dashboard.php",
				cache: false,
				data: {
					"nick": __0("player")
				}
			})
		}
		if (typeof globalGame != "undefined") {
			globalGame.shadowsEnable(__0("shadows") == "on");
			globalGame.hintsEnable(__0("hints") == "on")
		}
		$("link.skin").remove();
		$skin = $("<link />").addClass("skin").attr("rel", "stylesheet").attr("type", "text/css").attr("href", config.skin_path + (config.skin != null ? config.skin: "default") + "/stylesheets/" + (config.skin != null ? config.skin: "default") + ".css");
		$("head").append($skin);
		scoreboard_pos = __0("scoreboard_pos");
		$scoreboard = $("#scoreboard").clone();
		$("#scoreboard").remove();
		if (scoreboard_pos == "top") {
			$("#pool").before($scoreboard)
		} else {
			$("#pool").after($scoreboard)
		}
		scoreboard_style = __0("scoreboard_style");
		$("#scoreboard").removeClass("extended").removeClass("compact").removeClass("classic");
		$("#scoreboard").addClass(scoreboard_style);
		$("style.background").remove();
		$("body").css({
			"background-color": config.backgrounds[__0("skin")][__0("background")].color,
			"background-image": "url(" + config.backgrounds[__0("skin")][__0("background")].image + ")"
		})
	};
	_10f();
	_110(true);
	$(window).bind("unload", function() {
		$.ajax({
			url: "dashboard.php",
			cache: false,
			data: {
				"unregister": true
			}
		})
	});
	$(window).bind("beforeunload", function(e) {
		if (typeof network.vars.id != "undefined") {
			return "Do you really want to leave the game?"
		}
	});
	$("#console .top-panel").click(function() {
		$(this).parent().toggleClass("closed");
		if (!$(this).parent().hasClass("closed")) {
			$("#console ul.messages").scrollTop($("#console ul.messages").attr("scrollHeight"));
			$("input[name=chat]").focus()
		} else {
			$(window).click()
		}
		return false
	});
	$("#dashboard .top-panel").click(function() {
		if (typeof network.vars.practice != "undefined" || typeof network.vars.id != "undefined") {
			$("#dashboard").parents(".wrapper").toggleClass("closed");
			if (!$("#dashboard").parents(".wrapper").hasClass("closed")) {
				_111()
			}
		}
		return false
	});
	$("#rules .top-panel").click(function() {
		$(this).parents(".wrapper").toggleClass("closed");
		return false
	});
	$("#help .top-panel").click(function() {
		$(this).parent("#help").toggleClass("closed")
	});
	$("#settings button[name=cancel]").click(function() {
		$("#settings").parents(".wrapper").addClass("closed");
		return false
	});
	$("#settings button[name=save]").click(function() {
		$("#settings").parents(".wrapper").addClass("closed");
		_110();
		return false
	});
	$("#settings .top-panel").click(function() {
		_10f();
		$(this).parents(".wrapper").toggleClass("closed")
	});
	$("#frame-stats .top-panel").click(function() {
		$("#frame-stats").toggleClass("closed");
		return false
	});
	$("#match-options .top-panel").click(function() {
		$(this).parents(".wrapper").toggleClass("closed")
	});
	$("button[name=surrender]").click(function() {
		$(this).parents(".wrapper").addClass("closed");
		network.surrender();
		return false
	});
	$("#power-meter").height("50%");
	$("#power-bar").click(function(e) {
		$("#power-meter").height($(this).height() - (e.pageY - $(this).offset().top))
	});
	$(window).keyup(function(e) {
		if ($(e.target).is(":not(input, textarea, select, radio)") || $("input[name=chat]")[0] == document.activeElement) {
			if ($("input[name=chat]")[0] != document.activeElement || $("#console").hasClass("closed")) {
				if (e.keyCode == 73) {
					$("#irc-webchat").toggleClass("closed")
				}
				if (e.keyCode == 79) {
					$("#match-options").parents(".wrapper").toggleClass("closed")
				}
				if (e.keyCode == 48) {
					$("#power-meter").height("100%")
				}
				if (e.keyCode == 49) {
					$("#power-meter").height("10%")
				}
				if (e.keyCode == 50) {
					$("#power-meter").height("20%")
				}
				if (e.keyCode == 51) {
					$("#power-meter").height("30%")
				}
				if (e.keyCode == 52) {
					$("#power-meter").height("40%")
				}
				if (e.keyCode == 53) {
					$("#power-meter").height("50%")
				}
				if (e.keyCode == 54) {
					$("#power-meter").height("60%")
				}
				if (e.keyCode == 55) {
					$("#power-meter").height("70%")
				}
				if (e.keyCode == 56) {
					$("#power-meter").height("80%")
				}
				if (e.keyCode == 57) {
					$("#power-meter").height("90%")
				}
				if (e.keyCode == 83) {
					_10f();
					$("#settings").parents(".wrapper").toggleClass("closed")
				}
				if (e.keyCode == 68 || e.keyCode == 27) {
					if (typeof network.vars.practice != "undefined" || typeof network.vars.id != "undefined") {
						$("#dashboard").parents(".wrapper").toggleClass("closed");
						if (!$("#dashboard").parents(".wrapper").hasClass("closed")) {
							_111()
						}
					}
				}
				if (e.keyCode == 70) {
					$("#frame-stats").toggleClass("closed")
				}
				if (e.keyCode == 72) {
					$("#help").toggleClass("closed")
				}
				if (e.keyCode == 82) {
					$("#rules").parents(".wrapper").toggleClass("closed")
				}
			}
			if (e.keyCode == 192) {
				$("#console").toggleClass("closed");
				$("#console ul.messages").scrollTop($("#console ul.messages").attr("scrollHeight"));
				$("input[name=chat]").val("");
				if (!$("#console").hasClass("closed")) {
					$("input[name=chat]").focus()
				}
			}
		}
	});
	$(window).keypress(function(e) {
		if ($(e.target).is(":not(input, textarea, select, radio)") || $("input[name=chat]")[0] == document.activeElement) {
			if ($("input[name=chat]")[0] != document.activeElement || $("#console").hasClass("closed")) {
				if (e.keyCode == 45) {
					$("#power-meter").height($("#power-meter").height() - 5)
				}
				if (e.keyCode == 61) {
					$("#power-meter").height($("#power-meter").height() + 5)
				}
				if ($("#power-meter").height() > $("#power-bar").height()) {
					$("#power-meter").height($("#power-bar").height())
				}
			}
		}
	});
	$(window).mousewheel(function(e, _112) {
		if (_112 > 0) {
			$("#power-meter").height($("#power-meter").height() + 5)
		} else {
			if (_112 < 0) {
				$("#power-meter").height($("#power-meter").height() - 5)
			}
		}
		if ($("#power-meter").height() > $("#power-bar").height()) {
			$("#power-meter").height($("#power-bar").height())
		}
		if ($(e.target).parent().attr("id") != "console") {
			return false
		}
	});
	$("#servers table tr").live("click", function() {
		$("#servers table tr").removeClass("selected");
		$(this).addClass("selected");
		$("#servers").data("selected", $(this).attr("id"));
		$("button[name=join]").removeAttr("disabled");
		return false
	});
	function _113(_114) {
		filter = $("input[name=filter]").val();
		$("#servers table tr").removeClass("selected");
		$("button[name=join]").attr("disabled", "disabled");
		if (filter != "") {
			$("#servers table").find("tr").not(":first").filter(":not(:contains(" + filter + "))").hide();
			$("#servers table").find("tr").not(":first").filter(":contains(" + filter + ")").show()
		} else {
			$("#servers table tr").show()
		}
	};
	$("input[name=chat]").keydown(function(e) {
		if (e.keyCode == 13) {
			if (network.console($(this).val())) {
				$(this).val("")
			}
			return false
		}
		if (e.keyCode == 192) {
			return false
		}
		if ($(this).val().length >= 150) {
			return false
		}
	});
	$("input[name=filter]").keyup(function() {
		_113()
	}).change(function() {
		_113()
	});
	$("input[name=filter]").addClass("tip").data("tip", "Filter servers").val("Filter servers");
	$("input[name=filter]").focus(function() {
		if ($(this).val() == $(this).data("tip")) {
			$(this).val("").removeClass("tip")
		}
	});
	$("input[name=filter]").blur(function() {
		if ($(this).val() == "") {
			$(this).val($(this).data("tip")).addClass("tip")
		}
	});
	setInterval(_111, 5000);
	function _111() {
		if (!$("#dashboard").parents(".wrapper").hasClass("closed") || typeof network.vars.practice != "undefined") {
			$.ajax({
				url: "dashboard.php",
				cache: false,
				data: {
					"info": true
				},
				success: function(data) {
					data = $.parseJSON(data);
					//收到了别人的邀请
					if (data["invited"] != false) {
						$invitation_info = $("div.common-popup.invitation div.container p");
						$invitation_info.children("span").eq(0).text(data.invited.nick);
						$invitation_info.children("span").eq(1).text("Game mode: " + config.gamemodes[data.invited.data.gamemode] + ", Frames: " + data.invited.data.frames + ", Shot time: " + config.shottime[data.invited.data.shottime] + ", Password: " + (data.invited.data.password == 1 ? "Yes": "No"));
						$("#servers").data("selected", data.invited.data.server);
						$("#servers").data("password", data.invited.data.password);
						$("div.common-popup.invitation").parent(".wrapper").removeClass("closed")
					}
					$("div.lounge").data("selected", $("div.lounge ul.players li.selected").attr("id"));
					$("div.lounge ul.players li").remove();
					if (typeof data.nicks != "undefined") {
						$.each(data["nicks"],
						function(key, _115) {
							if (!_115.playing) {
								$("div.lounge ul.players").append($("<li />").attr("id", key.replace(".", "-")).append($("<a />").text(_115["nick"])))
							}
						});
						$.each(data["nicks"],
						function(key, _116) {
							if (_116.playing) {
								$("div.lounge ul.players").append($("<li />").addClass("inactive").attr("id", key.replace(".", "-")).append($("<a />").text(_116["nick"])))
							}
						});
						$("div.lounge ul.players li#" + $("div.lounge").data("selected")).addClass("selected")
					}
					var _117 = $("div.lounge ul.players li").length;
					$("div.lounge div.hint span").text((_117 > 0 ? _117: "no") + " players in it")
				}
			})
		}
		if (!$("#dashboard").parents(".wrapper").hasClass("closed")) {
			$("#dashboard button[name=join]").attr("disabled", "disabled");
			if ($("#servers tr.selected").length > 0) {
				$("#dashboard button[name=join]").removeAttr("disabled");
				$("#servers").data("selected", $("#servers tr.selected").attr("id"))
			}
			network.get("servers", {},
			function(data) {
				data = $.parseJSON(data);
				$("#servers p.status").hide();
				$("#servers table tr").not(":first").remove();
				if (typeof data != "undefined" && data["servers"].length > 0) {
					$.each(data["servers"],
					function(i, _118) {
						var _119 = "-";
						if (typeof _118.client_player != "undefined" && _118.client_player != null && _118.client_player != "") {
							_119 = "<img src=\"media/images/flags/" + _118.client_lang + ".gif\" class=\"lang\" />" + _118["client_player"]
						}
						$server = $("<tr />");
						$server.attr("id", _118["server_id"]);
						if (_118["password"] == 1) {
							$server.addClass("password")
						}
						$server.append($("<th />").text(_118["server_name"]));
						$server.append($("<th />").text(_118["password"] == 1 ? "Yes": "No"));
						$server.append($("<th />").text(_118["frames"]));
						$server.append($("<th />").text(config.shottime[_118["shottime"]]));
						$server.append($("<th />").text(config.gamemodes[_118["gamemode"]]));
						$server.append($("<th />").html("<img src=\"media/images/flags/" + _118["host_lang"] + ".gif\" class=\"lang\" />" + _118["host_player"]));
						$server.append($("<th />").html(_119));
						$("#servers table").append($server)
					});
					if (data["servers"].length == 0) {
						$("#servers p.status").show()
					}
					if ($("#servers tr#" + $("#servers").data("selected")).length > 0) {
						$("#servers tr#" + $("#servers").data("selected")).addClass("selected")
					}
				} else {
					$("#servers p.status").show()
				}
				$("#player-count").text(data["count"]["players"] + " players in " + data["count"]["servers"] + " servers")
			})
		}
	};
	$("button[name=refresh]").click(function() {
		_111();
		return false
	});
	$("button[name=host], a.host").click(function() {
		notify_permission();
		$("input[name=server_name]").val(__0("server_name"));
		$("#host-server").parents(".wrapper").removeClass("closed");
		return false
	});
	$("button[name=practice]").click(function() {
		notify_permission();
		window.location.href = "index.php?practice=single";
		return false
	});
	$("#host-server button[name=cancel]").click(function() {
		$(this).parents("#host-server").parent(".wrapper").addClass("closed");
		return false
	});

	/**
	 * 自己创建游戏服务器，点击开始游戏
	 */
	$("#host-server button[name=start]").click(function() {
		__2("server_name", $("input[name=server_name]").val());
		network.ajax(
			"host", 
			{
				"server_name": $("input[name=server_name]").val(),
				"name": __0("player"),
				"gamemode": $("select[name=gamemode] option:selected").val(),
				"shottime": $("select[name=shottime] option:selected").val(),
				"password": $("input[name=server_password]").val(),
				"lang": LANG.code,
				"frames": $("select[name=frames] option:selected").val()
			},
			function(data) {
				data = $.parseJSON(data);
				//是否邀请了某人
				var _11a = $("div.lounge ul.players li.selected").attr("id");
				if (_11a != null) {
					_11a = _11a.replace("-", ".");
					var _11b = data["server"]["id"];
					$.ajax({
						url: "dashboard.php",
						cache: false,
						data: {
							"invite": _11a,
							"server": data["server"]["id"].split("-")[0],
							"gamemode": $("select[name=gamemode] option:selected").val(),
							"shottime": $("select[name=shottime] option:selected").val(),
							"frames": $("select[name=frames] option:selected").val(),
							"password": ($("input[name=server_password]").val() != "" ? 1 : 0)
						},
						success: function(data) {
							window.location.href = "index.php?id=" + _11b + "&host=1"
						}
					})
				} else {
					window.location.href = "index1.php?id=" + data["server"]["id"] + "&host=1"
				}
			});
		return false
	});
	
	/**
	 * 输入密码后，点击cancel
	 */
	$("#enter-password button[name=cancel]").click(function() {
		$(this).parents("#enter-password").parent(".wrapper").addClass("closed");
		return false
	});

	/**
	 * 输入密码后，点击加入游戏
	 */
	$("#enter-password button[name=join]").click(function() {
		notify_permission();
		$server = $("#servers table tr.selected");
		if ($server.length > 0) {
			if (typeof network.vars.joingame != "undefined") {
				network.ajax("join", {
					"id": network.vars.joingame,
					"name": __0("player"),
					"password": $("input[name=client_password]").val(),
					"lang": LANG.code
				},
				function(data) {
					window.location.href = "index.php?id=" + data["server"]["id"]
				})
			} else {
				if (typeof network.vars.id == "undefined" || $("#servers").data("selected") != network.vars.id.split("-")[0]) {
					network.ajax("join", {
						"id": $("#servers").data("selected"),
						"name": __0("player"),
						"password": $("input[name=client_password]").val(),
						"lang": LANG.code
					},
					function(data) {
						window.location.href = "index.php?id=" + data["server"]["id"]
					})
				}
			}
		}
		$(this).parents(".wrapper").addClass("closed")
	});

	/**
	 * 选择游戏服务器后，点击加入游戏
	 */
	$("#options button[name=join]").click(function() {
		$server = $("#servers table tr.selected");
		if ($server.length > 0) {
			//该服务器需要输入密码，则弹出密码输入框。
			if ($server.hasClass("password")) {
				$("#enter-password").parents(".wrapper").removeClass("closed")
			} else {
				if (typeof network.vars.id == "undefined" || $("#servers").data("selected") != network.vars.id.split("-")[0]) {
					network.ajax("join", {
						"id": $("#servers").data("selected"),
						"name": __0("player"),
						"lang": LANG.code
					},
					function(data) {
						data = $.parseJSON(data);
						window.location.href = "index1.php?id=" + data["server"]["id"] + "&host=1"
					})
				}
			}
		}
		return false
	});
	if (typeof network.vars.joingame != "undefined") {
		if (typeof network.vars.password != "undefined" && network.vars.password == 1) {
			$("#enter-password").parents(".wrapper").removeClass("closed")
		} else {
			network.ajax("join", {
				"id": network.vars.joingame,
				"name": __0("player"),
				"lang": LANG.code
			},
			function(data) {
				window.location.href = "index.php?id=" + data["server"]["id"]
			})
		}
	}
	if (typeof network.vars.practice == "undefined" && typeof network.vars.id == "undefined") {
		var _11c = false;
		$("#loading-screen div.progress-bar").animate({
			"width": "100%"
		},
		1000,
		function() {
			_11c = true;
			$("#loading-screen").fadeOut(500)
		});
		$(window).ready(function() {
			if (_11c) {
				$("#loading-screen").fadeOut(500)
			}
		})
	} else {
		$(window).ready(function() {
			$("#loading-screen div.progress-bar").animate({
				"width": "100%"
			},
			1000,
			function() {
				$(this).parents("#loading-screen").fadeOut(500)
			})
		})
	}
	$("div.lounge ul.players li").live("click",
	function() {
		if (!$(this).hasClass("inactive")) {
			$(this).parent("ul.players").children("li").removeClass("selected");
			$(this).addClass("selected")
		}
		return false
	});
	$("div.lounge").click(function(e) {
		if (!$(e.target).is("a")) {
			$(this).find("li").removeClass("selected")
		}
	});
	if (typeof network.vars.id != "undefined" && typeof network.vars.host != "undefined") {
		$("div.common-popup.practice").parent(".wrapper").removeClass("closed");
		$("div.common-popup.practice button[name=ok]").click(function() {
			$(this).parents("div.common-popup.practice").parent(".wrapper").addClass("closed");
			return false
		})
	}

	//拒绝游戏邀请
	$("div.common-popup.invitation button[name=decline]").click(function() {
		$(this).parents("div.common-popup.invitation").parent(".wrapper").addClass("closed");
		return false
	});

	//接受游戏邀请
	$("div.common-popup.invitation button[name=accept]").click(function() {
		$(this).parents("div.common-popup.invitation").parent(".wrapper").addClass("closed");
		if ($("#servers").data("password") == 1) {
			$("#enter-password").parents(".wrapper").removeClass("closed")
		} else {
			network.ajax("join", {
				"id": $("#servers").data("selected"),
				"name": __0("player"),
				"lang": LANG.code
			},
			function(data) {
				window.location.href = "index.php?id=" + data["server"]["id"]
			})
		}
		return false
	});
	$.ajax({
		url: "dashboard.php",
		cache: false,
		data: {
			"nick": __0("player")
		},
		complete: function() {
			$.ajax({
				url: "dashboard.php",
				cache: false,
				data: {
					"playing": (typeof network.vars.id == "undefined" ? 0 : 1)
				},
				complete: function() {
					_111()
				}
			})
		}
	});
	$log = $("#console ul.messages");
	$log.children("li").last().removeClass("last");
	$message = $("<li />").html("<a href=\"http://webchat.quakenet.org/?channels=websnooker&uio=d4\" class=\"irc\">Come visit WebSnooker IRC Channel: #websnooker @ QuakeNet</a>");
	$message.addClass("last");
	$log.append($message);
	$("#console ul.messages").scrollTop($("#console ul.messages").attr("scrollHeight"))
});