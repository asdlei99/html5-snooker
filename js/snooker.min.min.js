$(function() {
	var ua = navigator.userAgent.toString().toLowerCase();
	if (supports_local_storage() && supports_canvas() && !($.browser.opera && parseInt($.browser.version) < 10) && !((ua.indexOf("safari") != -1) && !(ua.indexOf("chrome") != -1))) {
		$("#browser-detect").parent().hide()
	} else {
		return
	}
});

/**
 * 本地缓存
 */
if (supports_local_storage()) {
	config.skin = __18("skin");
	config.player = __18("player");
	config.screoboard_pos = __18("scoreboard_pos");
	config.screoboard_style = __18("scoreboard_style");
	config.shadows = __18("shadows");
	config.background = __18("background");
	config.hints = __18("hints");
	config.cue = __18("cue")
}


$(window).bind("unload", function(e) {
	$.ajax({
		url: config.masterserver + "?query=send&id=" + network.vars.id + "&event=disconnect",
		success: function(data) {},
		async: false
	})
});

window_active = true;
$(window).focus(function() {
	window_active = true
});
$(window).blur(function() {
	window_active = false
});

var auto_refresh_timeout = null;

/**
 * 注册事件吧
 */
$(function() {
	$("body").css("overflow", "hidden");
	if ($(window).height() <= 666) {
		$("body").css("overflow-y", "scroll")
	}
	$(window).resize(function() {
		if ($(window).height() <= 666) {
			$("body").css("overflow-y", "scroll")
		} else {
			$("body").css("overflow-y", "hidden")
		}
	});
	network.prepare();
	if (__18("player") == "Guest") {
		$("#enter-name").parent(".wrapper").removeClass("closed")
	}
	$(window).keyup(function(e) {
		if ($("#enter-name").is(":visible")) {
			if ($("#enter-name input[name=player]").val() != "") {
				$("#enter-name button[name=save]").removeAttr("disabled")
			} else {
				$("#enter-name button[name=save]").attr("disabled", "disabled")
			}
		}
	});
	$("#enter-name input[name=player]").change(function() {
		if ($(this).val() != "") {
			$(this).parents("#enter-name").find("button[name=save]").removeAttr("disabled")
		} else {
			$(this).parents("#enter-name").find("button[name=save]").attr("disabled", "disabled")
		}
	});
	$("#enter-name button[name=save]").click(function() {
		var _134 = $("#enter-name input[name=player]").val();
		if (_134 != "") {
			__20("player", _134);
			__20("enter-name", "off");
			$.ajax({
				url: "dashboard",
				cache: false,
				data: {
					"nick": _134
				}
			});
			$("#enter-name").parent().addClass("closed")
		}
		return false
	});
	$("#community-menu ul.categories li a[href=#news]").click(function() {
		$("#news").parent().removeClass("closed");
		return false
	});
	$("#community-menu ul.categories li a[href=#welcome-screen]").click(function() {
		$("#welcome-screen").parent().show();
		return false
	});
	$("#community-menu ul.categories li a[href=#webchat], #irc-webchat .top-panel").click(function() {
		$("#irc-webchat").toggleClass("closed");
		return false
	});
	$("#community-menu ul.categories li a[href=#credits]").click(function() {
		$("#credits").parent(".wrapper").toggleClass("closed");
		return false
	});
	$("a.irc").live("click", function() {
		$("#irc-webchat").removeClass("closed");
		return false
	});
	$("#news .top-panel").click(function() {
		$(this).parents(".wrapper").toggleClass("closed");
		__20("news-" + hex_md5($("#news ul li:first time").text()), "off");
		return false
	});
	$("#news button[name=okay]").click(function() {
		$(this).parents(".wrapper").addClass("closed");
		__20("news-" + hex_md5($("#news ul li:first time").text()), "off");
		return false
	});
	$("#credits button[name=okay]").click(function() {
		$(this).parents(".wrapper").addClass("closed");
		return false
	});
	$("div.social iframe").load(function() {
		$(this).parent(".social").width($(this).width() - 5)
	});
	$("button[name=welcome]").click(function() {
		notify_permission();
		$(this).parents(".wrapper").hide();
		_135();
		$("#settings").parents(".wrapper").removeClass("closed");
		return false
	});
	function _135() {
		$("#settings input[name=player]").val(__18("player"));
		$("#settings select[name=skin]").val(__18("skin"));
		$("#settings select[name=scoreboard-style]").val(__18("scoreboard_style"));
		$("#settings radio").removeAttr("checked");
		$("#settings input:radio[value=" + __18("scoreboard_pos") + "]").attr("checked", "checked");
		$("#settings input[name=sound]").attr("checked", __18("sound") == "on");
		$("#settings input[name=shadows]").attr("checked", __18("shadows") == "on");
		$("#settings input[name=hints]").attr("checked", __18("hints") == "on");
		$("#settings input[name=cue]").attr("checked", __18("cue") == "on");
		$("#settings select[name=background]").val(__18("background"))
	};
	function _136(init) {
		if (typeof init == "undefined") {
			init = false
		}
		__20("player", $("#settings input[name=player]").val());
		__20("skin", $("#settings select[name=skin]").val());
		__20("scoreboard_pos", $("#settings input:radio[name=scoreboard-position]:checked").val());
		__20("scoreboard_style", $("#settings select[name=scoreboard-style]").val());
		__20("sound", ($("#settings input[name=sound]").attr("checked") ? "on": "off"));
		__20("shadows", ($("#settings input[name=shadows]").attr("checked") ? "on": "off"));
		__20("hints", ($("#settings input[name=hints]").attr("checked") ? "on": "off"));
		__20("background", $("#settings select[name=background]").val());
		__20("cue", ($("#settings input[name=cue]").attr("checked") ? "on": "off"));
		if (!init) {
			$.ajax({
				url: "dashboard",
				cache: false,
				data: {
					"nick": __18("player")
				}
			})
		}
		if (typeof globalGame != "undefined") {
			globalGame.shadowsEnable(__18("shadows") == "on");
			globalGame.hintsEnable(__18("hints") == "on")
		}
		$("link.skin").remove();
		$skin = $("<link />").addClass("skin").attr("rel", "stylesheet").attr("type", "text/css").attr("href", config.skin_path + (config.skin != null ? config.skin: "default") + "/stylesheets/" + (config.skin != null ? config.skin: "default") + ".css");
		$("head").append($skin);
		scoreboard_pos = __18("scoreboard_pos");
		$scoreboard = $("#scoreboard").clone();
		$("#scoreboard").remove();
		if (scoreboard_pos == "top") {
			$("#pool").before($scoreboard)
		} else {
			$("#pool").after($scoreboard)
		}
		scoreboard_style = __18("scoreboard_style");
		$("#scoreboard").removeClass("extended").removeClass("compact").removeClass("classic");
		$("#scoreboard").addClass(scoreboard_style);
		$("style.background").remove();
		$("body").css({
			"background-color": config.backgrounds[__18("skin")][__18("background")].color,
			"background-image": "url(" + config.backgrounds[__18("skin")][__18("background")].image + ")"
		})
	};
	_135();
	_136(true);
	$(window).bind("unload", function() {
		$.ajax({
			url: "dashboard",
			cache: false,
			data: {
				"unregister": true
			}
		})
	});
	$(window).bind("beforeunload", function(e) {
		if (typeof network.vars.id != "undefined") {
			return "Do you really want to leave the game?"
		}
	});
	$("#console .top-panel").click(function() {
		$(this).parent().toggleClass("closed");
		if (!$(this).parent().hasClass("closed")) {
			$("#console ul.messages").scrollTop($("#console ul.messages").attr("scrollHeight"));
			$("input[name=chat]").focus()
		} else {
			$(window).click()
		}
		return false
	});
	$("#dashboard .top-panel").click(function() {
		if (typeof network.vars.practice != "undefined" || typeof network.vars.id != "undefined") {
			$("#dashboard").parents(".wrapper").toggleClass("closed");
			if (!$("#dashboard").parents(".wrapper").hasClass("closed")) {
				_137()
			}
		}
		return false
	});
	$("#rules .top-panel").click(function() {
		$(this).parents(".wrapper").toggleClass("closed");
		return false
	});
	$("#help .top-panel").click(function() {
		$(this).parent("#help").toggleClass("closed")
	});
	$("#settings button[name=cancel]").click(function() {
		$("#settings").parents(".wrapper").addClass("closed");
		return false
	});
	$("#settings button[name=save]").click(function() {
		$("#settings").parents(".wrapper").addClass("closed");
		_136();
		return false
	});
	$("#settings .top-panel").click(function() {
		_135();
		$(this).parents(".wrapper").toggleClass("closed")
	});
	$("#frame-stats .top-panel").click(function() {
		$("#frame-stats").toggleClass("closed");
		return false
	});
	$("#match-options .top-panel").click(function() {
		$(this).parents(".wrapper").toggleClass("closed")
	});
	$("button[name=surrender]").click(function() {
		$(this).parents(".wrapper").addClass("closed");
		network.surrender();
		return false
	});
	$("#power-meter").height("50%");
	$("#power-bar").click(function(e) {
		$("#power-meter").height($(this).height() - (e.pageY - $(this).offset().top))
	});
	$(window).keyup(function(e) {
		if ($(e.target).is(":not(input, textarea, select, radio)") || $("input[name=chat]")[0] == document.activeElement) {
			if ($("input[name=chat]")[0] != document.activeElement || $("#console").hasClass("closed")) {
				if (e.keyCode == 73) {
					$("#irc-webchat").toggleClass("closed")
				}
				if (e.keyCode == 79) {
					$("#match-options").parents(".wrapper").toggleClass("closed")
				}
				if (e.keyCode == 48) {
					$("#power-meter").height("100%")
				}
				if (e.keyCode == 49) {
					$("#power-meter").height("10%")
				}
				if (e.keyCode == 50) {
					$("#power-meter").height("20%")
				}
				if (e.keyCode == 51) {
					$("#power-meter").height("30%")
				}
				if (e.keyCode == 52) {
					$("#power-meter").height("40%")
				}
				if (e.keyCode == 53) {
					$("#power-meter").height("50%")
				}
				if (e.keyCode == 54) {
					$("#power-meter").height("60%")
				}
				if (e.keyCode == 55) {
					$("#power-meter").height("70%")
				}
				if (e.keyCode == 56) {
					$("#power-meter").height("80%")
				}
				if (e.keyCode == 57) {
					$("#power-meter").height("90%")
				}
				if (e.keyCode == 83) {
					_135();
					$("#settings").parents(".wrapper").toggleClass("closed")
				}
				if (e.keyCode == 68 || e.keyCode == 27) {
					if (typeof network.vars.practice != "undefined" || typeof network.vars.id != "undefined") {
						$("#dashboard").parents(".wrapper").toggleClass("closed");
						if (!$("#dashboard").parents(".wrapper").hasClass("closed")) {
							_137()
						}
					}
				}
				if (e.keyCode == 70) {
					$("#frame-stats").toggleClass("closed")
				}
				if (e.keyCode == 72) {
					$("#help").toggleClass("closed")
				}
				if (e.keyCode == 82) {
					$("#rules").parents(".wrapper").toggleClass("closed")
				}
			}
			if (e.keyCode == 192) {
				$("#console").toggleClass("closed");
				$("#console ul.messages").scrollTop($("#console ul.messages").attr("scrollHeight"));
				$("input[name=chat]").val("");
				if (!$("#console").hasClass("closed")) {
					$("input[name=chat]").focus()
				}
			}
		}
	});
	$(window).keypress(function(e) {
		if ($(e.target).is(":not(input, textarea, select, radio)") || $("input[name=chat]")[0] == document.activeElement) {
			if ($("input[name=chat]")[0] != document.activeElement || $("#console").hasClass("closed")) {
				if (e.keyCode == 45) {
					$("#power-meter").height($("#power-meter").height() - 5)
				}
				if (e.keyCode == 61) {
					$("#power-meter").height($("#power-meter").height() + 5)
				}
				if ($("#power-meter").height() > $("#power-bar").height()) {
					$("#power-meter").height($("#power-bar").height())
				}
			}
		}
	});
	$(window).mousewheel(function(e, _138) {
		if (_138 > 0) {
			$("#power-meter").height($("#power-meter").height() + 5)
		} else {
			if (_138 < 0) {
				$("#power-meter").height($("#power-meter").height() - 5)
			}
		}
		if ($("#power-meter").height() > $("#power-bar").height()) {
			$("#power-meter").height($("#power-bar").height())
		}
		if ($(e.target).parent().attr("id") != "console") {
			return false
		}
	});
	$("#servers table tr").live("click", function() {
		$("#servers table tr").removeClass("selected");
		$(this).addClass("selected");
		$("#servers").data("selected", $(this).attr("id"));
		$("button[name=join]").removeAttr("disabled");
		return false
	});
	function _139(_13a) {
		filter = $("input[name=filter]").val();
		$("#servers table tr").removeClass("selected");
		$("button[name=join]").attr("disabled", "disabled");
		if (filter != "") {
			$("#servers table").find("tr").not(":first").filter(":not(:contains(" + filter + "))").hide();
			$("#servers table").find("tr").not(":first").filter(":contains(" + filter + ")").show()
		} else {
			$("#servers table tr").show()
		}
	};
	$("input[name=chat]").keydown(function(e) {
		if (e.keyCode == 13) {
			if (network.console($(this).val())) {
				$(this).val("")
			}
			return false
		}
		if (e.keyCode == 192) {
			return false
		}
		if ($(this).val().length >= 150) {
			return false
		}
	});
	$("input[name=filter]").keyup(function() {
		_139()
	}).change(function() {
		_139()
	});
	$("input[name=filter]").addClass("tip").data("tip", "Filter servers").val("Filter servers");
	$("input[name=filter]").focus(function() {
		if ($(this).val() == $(this).data("tip")) {
			$(this).val("").removeClass("tip")
		}
	});
	$("input[name=filter]").blur(function() {
		if ($(this).val() == "") {
			$(this).val($(this).data("tip")).addClass("tip")
		}
	});
	setInterval(_137, 5000);
	function _137() {
		if (!$("#dashboard").parents(".wrapper").hasClass("closed") || typeof network.vars.practice != "undefined") {
			$.ajax({
				url: "dashboard",
				cache: false,
				data: {
					"info": true
				},
				success: function(data) {
					data = $.parseJSON(data);
					if (data["invited"] != false) {
						$invitation_info = $("div.common-popup.invitation div.container p");
						$invitation_info.children("span").eq(0).text(data.invited.nick);
						$invitation_info.children("span").eq(1).text("Game mode: " + config.gamemodes[data.invited.data.gamemode] + ", Frames: " + data.invited.data.frames + ", Shot time: " + config.shottime[data.invited.data.shottime] + ", Password: " + (data.invited.data.password == 1 ? "Yes": "No"));
						$("#servers").data("selected", data.invited.data.server);
						$("#servers").data("password", data.invited.data.password);
						$("div.common-popup.invitation").parent(".wrapper").removeClass("closed")
					}
					$("div.lounge").data("selected", $("div.lounge ul.players li.selected").attr("id"));
					$("div.lounge ul.players li").remove();
					if (typeof data.nicks != "undefined") {
						$.each(data["nicks"],
						function(key, _13b) {
							if (!_13b.playing) {
								$("div.lounge ul.players").append($("<li />").attr("id", key.replace(".", "-")).append($("<a />").text(_13b["nick"])))
							}
						});
						$.each(data["nicks"],
						function(key, _13c) {
							if (_13c.playing) {
								$("div.lounge ul.players").append($("<li />").addClass("inactive").attr("id", key.replace(".", "-")).append($("<a />").text(_13c["nick"])))
							}
						});
						$("div.lounge ul.players li#" + $("div.lounge").data("selected")).addClass("selected")
					}
					var _13d = $("div.lounge ul.players li").length;
					$("div.lounge div.hint span").text((_13d > 0 ? _13d: "no") + " players in it")
				}
			})
		}
		if (!$("#dashboard").parents(".wrapper").hasClass("closed")) {
			$("#dashboard button[name=join]").attr("disabled", "disabled");
			if ($("#servers tr.selected").length > 0) {
				$("#dashboard button[name=join]").removeAttr("disabled");
				$("#servers").data("selected", $("#servers tr.selected").attr("id"))
			}
			network.get("servers", {},
			function(data) {
				$("#servers p.status").hide();
				$("#servers table tr").not(":first").remove();
				if (typeof data != "undefined" && data["servers"].length > 0) {
					$.each(data["servers"],
					function(i, _13e) {
						var _13f = "-";
						if (typeof _13e.client_player != "undefined" && _13e.client_player != null && _13e.client_player != "") {
							_13f = "<img src=\"media/images/flags/" + _13e.client_lang + ".gif\" class=\"lang\" />" + _13e["client_player"]
						}
						$server = $("<tr />");
						$server.attr("id", _13e["server_id"]);
						if (_13e["password"] == 1) {
							$server.addClass("password")
						}
						$server.append($("<th />").text(_13e["server_name"]));
						$server.append($("<th />").text(_13e["password"] == 1 ? "Yes": "No"));
						$server.append($("<th />").text(_13e["frames"]));
						$server.append($("<th />").text(config.shottime[_13e["shottime"]]));
						$server.append($("<th />").text(config.gamemodes[_13e["gamemode"]]));
						$server.append($("<th />").html("<img src=\"media/images/flags/" + _13e["host_lang"] + ".gif\" class=\"lang\" />" + _13e["host_player"]));
						$server.append($("<th />").html(_13f));
						$("#servers table").append($server)
					});
					if (data["servers"].length == 0) {
						$("#servers p.status").show()
					}
					if ($("#servers tr#" + $("#servers").data("selected")).length > 0) {
						$("#servers tr#" + $("#servers").data("selected")).addClass("selected")
					}
				} else {
					$("#servers p.status").show()
				}
				$("#player-count").text(data["count"]["players"] + " players in " + data["count"]["servers"] + " servers")
			})
		}
	};
	$("button[name=refresh]").click(function() {
		_137();
		return false
	});
	$("button[name=host], a.host").click(function() {
		notify_permission();
		$("input[name=server_name]").val(__18("server_name"));
		$("#host-server").parents(".wrapper").removeClass("closed");
		return false
	});
	$("button[name=practice]").click(function() {
		notify_permission();
		window.location.href = "?practice=single";
		return false
	});
	$("#host-server button[name=cancel]").click(function() {
		$(this).parents("#host-server").parent(".wrapper").addClass("closed");
		return false
	});
	$("#host-server button[name=start]").click(function() {
		__20("server_name", $("input[name=server_name]").val());
		network.ajax("host", {
			"server_name": $("input[name=server_name]").val(),
			"name": __18("player"),
			"gamemode": $("select[name=gamemode] option:selected").val(),
			"shottime": $("select[name=shottime] option:selected").val(),
			"password": $("input[name=server_password]").val(),
			"lang": LANG.code,
			"frames": $("select[name=frames] option:selected").val()
		},
		function(data) {
			var _140 = $("div.lounge ul.players li.selected").attr("id");
			if (_140 != null) {
				_140 = _140.replace("-", ".");
				var _141 = data["server"]["id"];
				$.ajax({
					url: "dashboard",
					cache: false,
					data: {
						"invite": _140,
						"server": data["server"]["id"].split("-")[0],
						"gamemode": $("select[name=gamemode] option:selected").val(),
						"shottime": $("select[name=shottime] option:selected").val(),
						"frames": $("select[name=frames] option:selected").val(),
						"password": ($("input[name=server_password]").val() != "" ? 1 : 0)
					},
					success: function(data) {
						window.location.href = "?id=" + _141 + "&host=1"
					}
				})
			} else {
				window.location.href = "?id=" + data["server"]["id"] + "&host=1"
			}
		});
		return false
	});
	$("#enter-password button[name=cancel]").click(function() {
		$(this).parents("#enter-password").parent(".wrapper").addClass("closed");
		return false
	});
	$("#enter-password button[name=join]").click(function() {
		notify_permission();
		$server = $("#servers table tr.selected");
		if ($server.length > 0) {
			if (typeof network.vars.joingame != "undefined") {
				network.ajax("join", {
					"id": network.vars.joingame,
					"name": __18("player"),
					"password": $("input[name=client_password]").val(),
					"lang": LANG.code
				},
				function(data) {
					window.location.href = "?id=" + data["server"]["id"]
				})
			} else {
				if (typeof network.vars.id == "undefined" || $("#servers").data("selected") != network.vars.id.split("-")[0]) {
					network.ajax("join", {
						"id": $("#servers").data("selected"),
						"name": __18("player"),
						"password": $("input[name=client_password]").val(),
						"lang": LANG.code
					},
					function(data) {
						window.location.href = "?id=" + data["server"]["id"]
					})
				}
			}
		}
		$(this).parents(".wrapper").addClass("closed")
	});
	$("#options button[name=join]").click(function() {
		$server = $("#servers table tr.selected");
		if ($server.length > 0) {
			if ($server.hasClass("password")) {
				$("#enter-password").parents(".wrapper").removeClass("closed")
			} else {
				if (typeof network.vars.id == "undefined" || $("#servers").data("selected") != network.vars.id.split("-")[0]) {
					network.ajax("join", {
						"id": $("#servers").data("selected"),
						"name": __18("player"),
						"lang": LANG.code
					},
					function(data) {
						window.location.href = "?id=" + data["server"]["id"]
					})
				}
			}
		}
		return false
	});
	if (typeof network.vars.joingame != "undefined") {
		if (typeof network.vars.password != "undefined" && network.vars.password == 1) {
			$("#enter-password").parents(".wrapper").removeClass("closed")
		} else {
			network.ajax("join", {
				"id": network.vars.joingame,
				"name": __18("player"),
				"lang": LANG.code
			},
			function(data) {
				window.location.href = "?id=" + data["server"]["id"]
			})
		}
	}
	if (typeof network.vars.practice == "undefined" && typeof network.vars.id == "undefined") {
		var _142 = false;
		$("#loading-screen div.progress-bar").animate({
			"width": "100%"
		},
		1000,
		function() {
			_142 = true;
			$("#loading-screen").fadeOut(500)
		});
		$(window).ready(function() {
			if (_142) {
				$("#loading-screen").fadeOut(500)
			}
		})
	} else {
		$(window).ready(function() {
			$("#loading-screen div.progress-bar").animate({
				"width": "100%"
			},
			1000,
			function() {
				$(this).parents("#loading-screen").fadeOut(500)
			})
		})
	}
	$("div.lounge ul.players li").live("click", function() {
		if (!$(this).hasClass("inactive")) {
			$(this).parent("ul.players").children("li").removeClass("selected");
			$(this).addClass("selected")
		}
		return false
	});
	$("div.lounge").click(function(e) {
		if (!$(e.target).is("a")) {
			$(this).find("li").removeClass("selected")
		}
	});
	if (typeof network.vars.id != "undefined" && typeof network.vars.host != "undefined") {
		$("div.common-popup.practice").parent(".wrapper").removeClass("closed");
		$("div.common-popup.practice button[name=ok]").click(function() {
			$(this).parents("div.common-popup.practice").parent(".wrapper").addClass("closed");
			return false
		})
	}
	$("div.common-popup.invitation button[name=decline]").click(function() {
		$(this).parents("div.common-popup.invitation").parent(".wrapper").addClass("closed");
		return false
	});
	$("div.common-popup.invitation button[name=accept]").click(function() {
		$(this).parents("div.common-popup.invitation").parent(".wrapper").addClass("closed");
		if ($("#servers").data("password") == 1) {
			$("#enter-password").parents(".wrapper").removeClass("closed")
		} else {
			network.ajax("join", {
				"id": $("#servers").data("selected"),
				"name": __18("player"),
				"lang": LANG.code
			},
			function(data) {
				window.location.href = "?id=" + data["server"]["id"]
			})
		}
		return false
	});
	$.ajax({
		url: "dashboard",
		cache: false,
		data: {
			"nick": __18("player")
		},
		complete: function() {
			$.ajax({
				url: "dashboard",
				cache: false,
				data: {
					"playing": (typeof network.vars.id == "undefined" ? 0 : 1)
				},
				complete: function() {
					_137()
				}
			})
		}
	});
	$log = $("#console ul.messages");
	$log.children("li").last().removeClass("last");
	$message = $("<li />").html("ijibu ceshi");
	//$message = $("<li />").html("<a href=\"http://webchat.quakenet.org/?channels=websnooker&uio=d4\" class=\"irc\">Come visit WebSnooker IRC Channel: #websnooker @ QuakeNet</a>");
	$message.addClass("last");
	$log.append($message);
	$("#console ul.messages").scrollTop($("#console ul.messages").attr("scrollHeight"))
});


$(function() {
	var oTimer = new Timer(40);
	var oRenderer = new Renderer();
	var oSound = new Sound();
	var oInput = new Input();
	$("#stop").click(function() {
		oTimer.stop();
		return false
	});
	$("#resume").click(function() {
		oTimer.resume();
		return false
	});
	$("#wire").click(function() {
		oRenderer.mode = oRenderer.WIREFRAME;
		return false
	});
	$("#texture").click(function() {
		oRenderer.mode = oRenderer.TEXTURED;
		return false
	});
	var game = new Game(oTimer, oRenderer, oSound, oInput);
	globalGame = game;
	game.initialize();
	new Progress(50, function() {
		return oRenderer.getImageLoadProgress()
	});
	$(window).ready(function() {
		oTimer.start(function() {
			game.process()
		},
		function() {
			game.render()
		})
	})
});